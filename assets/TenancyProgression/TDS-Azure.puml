@startuml "Image Analysis System"

!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Container.puml
!define AzurePuml https://raw.githubusercontent.com/RicardoNiepel/Azure-PlantUML/release/2-1/dist
!includeurl AzurePuml/AzureCommon.puml
!includeurl AzurePuml/Compute/AzureFunction.puml
!includeurl AzurePuml/Integration/AzureEventGrid.puml
!includeurl AzurePuml/Storage/AzureQueueStorage.puml

LAYOUT_LEFT_RIGHT
LAYOUT_WITH_LEGEND()

Container(hub, Hub, "Hub Web API")
Container(WebJob, WebJob, "Hub Web Job")
ContainerDb(Sql, Sql, "Hub Sql")
Container(hubNote, Notification, "Hub Notification")

ContainerDb(TdsDb, "TDS Service Storage", "Table Storage")

AzureQueueStorage(InQ, "InBound Queue", "Storage Queue")
AzureQueueStorage(OutQ, "OutBound Queue", "Storage Queue")

AzureFunction(fnCreate, "Create", "Queue Trigger")
AzureFunction(fnStatus, "Status", "Timer Trigger")
AzureFunction(fnCert, "Get Deposit Protection Cert", "C#")

System_Ext(Tds, "Tenancy Deposit Scheme")

InQ --> fnCreate
fnCreate --> Tds : Create Request
fnStatus --> Tds : Status Request
fnCert --> Tds : Deposit Protection certificate Request 

TdsDb <-- fnCreate : Insert
TdsDb --> fnStatus : Status - Pending
TdsDb <-- fnStatus : Update
TdsDb --> fnCert : Status - Complete

OutQ <-- fnCert

hub --> InQ
WebJob <-- OutQ

hubNote <-- WebJob
Sql <-- WebJob


@enduml